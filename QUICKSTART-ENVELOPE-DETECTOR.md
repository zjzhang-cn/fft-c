# 包络检波器快速入门

## 什么是包络检波器？

包络检波器是一个模拟电路，用于从 AM（幅度调制）信号中提取原始调制信号。它由两个主要部分组成：

1. **二极管整流器** - 将 AM 信号整流为单向脉动信号
2. **RC 低通滤波器** - 滤除载波频率，保留调制信号包络

## 快速开始

### 1. 编译程序

```bash
# 方法 1: 使用 Makefile
make envelope_detector

# 方法 2: 直接编译
gcc -o envelope_detector envelope_detector.c -lm -O2
```

### 2. 运行程序

```bash
./envelope_detector
```

程序会自动：
- 生成 AM 调制信号
- 计算最佳 RC 参数
- 执行包络检波
- 测试不同参数的影响
- 保存结果到 CSV 文件

### 3. 查看结果

```bash
# 查看数据文件
head envelope_detector_result.csv

# 绘制结果图
python3 plot_envelope_detector.py
```

### 4. 运行完整测试

```bash
# 使用测试脚本
./test_envelope_detector.sh
```

## 输出文件

运行后会生成：

- `envelope_detector_result.csv` - 数据文件（时间、AM信号、解调信号）
- `envelope_detector_result.png` - 结果可视化
- `rc_filter_response.png` - RC滤波器频率响应
- `diode_characteristic.png` - 二极管特性曲线

## 可视化选项

```bash
# 绘制包络检波结果
python3 plot_envelope_detector.py

# 绘制 RC 滤波器响应
python3 plot_envelope_detector.py --rc

# 绘制二极管特性
python3 plot_envelope_detector.py --diode

# 绘制所有图表
python3 plot_envelope_detector.py --all
```

## 工作原理示意

```
输入: AM 信号 s(t) = [1 + μ·cos(2πfₘt)]·cos(2πfₒt)
                     ↓
              ┌──────────┐
              │  二极管   │  整流
              └──────────┘
                     ↓
              ┌──────────┐
              │ RC 滤波器 │  提取包络
              └──────────┘
                     ↓
输出: 解调信号 m(t) ≈ cos(2πfₘt)
```

## 电路参数

### 默认配置

- **载波频率**: 10 kHz
- **调制频率**: 500 Hz
- **调制指数**: 0.8
- **二极管压降**: 0.7 V
- **电阻 R**: 47 kΩ（自动计算）
- **电容 C**: 0.1 μF（自动计算）

### 参数影响

| RC 值 | 时间常数 | 截止频率 | 效果 |
|------|---------|---------|-----|
| 太小 | 短 | 高 | 滤波不足，载波残留 |
| 最佳 | 中等 | 适中 | 良好解调 |
| 太大 | 长 | 低 | 响应慢，信号失真 |

## 示例输出

```
========================================
  包络检波电路模拟器
  二极管 + RC 低通滤波器
========================================

信号参数:
  载波频率 fc = 10000 Hz
  调制频率 fm = 500 Hz
  采样频率 fs = 100000 Hz
  调制指数 μ = 0.80
  采样点数 n = 1000

=== RC 参数计算 ===
载波频率 fc = 10000.00 Hz
调制频率 fm = 500.00 Hz
目标截止频率 = 500.00 Hz

推荐参数:
  R = 47000 Ω (47 kΩ)
  C = 1.00e-07 F (0.10 μF)
  实际截止频率 = 33.86 Hz
  τ = RC = 4.70e-03 s (4.70 ms)

=== 包络检波器电路模拟 ===
✓ 二极管整流完成（Vd = 0.70 V）
✓ RC 低通滤波完成
✓ 直流分量去除完成（DC = 0.5112 V）

数据已保存到 envelope_detector_result.csv

=== 性能分析 ===
均方根误差 RMSE = 0.817584
```

## 常见问题

### Q: 为什么解调信号有失真？

A: 可能原因：
1. RC 时间常数不合适
2. 调制指数过大（过调制）
3. 二极管压降影响

### Q: 如何优化参数？

A: 程序会自动计算最佳参数，遵循：
1. 截止频率 fc << 载波频率
2. 截止频率 fc > 调制频率
3. 典型选择：fc ≈ 5-10 × 调制频率

### Q: 如何处理不同的信号？

A: 修改 `main()` 函数中的参数：
```c
double fc = 10000.0;      // 载波频率
double fm = 500.0;        // 调制频率
double mod_index = 0.8;   // 调制指数
```

## 扩展实验

### 实验 1: 测试不同调制指数

修改代码中的 `mod_index` 值（0.1 ~ 1.2），观察：
- 正常调制（< 1.0）
- 100% 调制（= 1.0）
- 过调制（> 1.0）

### 实验 2: 测试不同 RC 参数

在程序末尾已经包含了参数测试代码，观察：
- R 太小的效果
- R 太大的效果
- 最佳参数的效果

### 实验 3: 添加噪声

在 AM 信号生成后添加噪声：
```c
am_signal[i] += 0.1 * ((double)rand() / RAND_MAX - 0.5);
```

## 教学用途

本程序适用于：

1. **通信原理课程**
   - AM 调制解调原理
   - 包络检波器工作机制

2. **模拟电子技术**
   - 二极管特性
   - RC 滤波器设计

3. **信号处理**
   - 包络检测
   - 低通滤波

4. **数值模拟**
   - 微分方程离散化
   - 欧拉法 vs 梯形法

## 相关文档

- `README-ENVELOPE-DETECTOR.md` - 详细技术文档
- `README-AM.md` - AM 调制解调系统文档
- 测试脚本: `test_envelope_detector.sh`

## 下一步

1. 尝试修改信号参数
2. 观察不同 RC 参数的影响
3. 比较不同二极管模型
4. 添加噪声分析
5. 实现其他解调方法

## 技术支持

如有问题，请查看：
- README-ENVELOPE-DETECTOR.md
- 源代码注释
- 测试脚本输出

---

祝学习愉快！🎓
