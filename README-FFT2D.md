# 2D FFT (二维傅里叶变换) 程序

## 功能介绍

这个程序实现了二维离散傅里叶变换(2D DFT)和逆变换(2D IDFT),可以对图像进行频域分析和重建,并将结果保存为BMP图像文件。

## 主要特性

- ✨ **2D DFT实现**: 使用行列分离方法实现二维傅里叶变换
- 🔄 **2D IDFT实现**: 从频域数据完美还原原始图像
- 🖼️ **BMP图像输出**: 自动生成并保存BMP格式图像文件
- 📊 **频谱中心化**: FFTShift功能,将零频率移到频谱中心
- 🎨 **多种可视化**: 提供对数和线性两种幅度谱显示方式
- 🔧 **灵活配置**: 支持多种测试图像模式(正弦波、圆形、方形等)
- ✅ **精度验证**: 自动计算并显示图像还原误差统计

## 编译运行

```bash
# 编译
gcc -Wall -Wextra -O2 -std=c99 -o fft2d main-fft2d.c -lm

# 运行
./fft2d
```

## 输出文件

程序会生成以下BMP图像文件:

1. **original_image.bmp** - 原始测试图像 (256x256像素)
2. **magnitude_spectrum.bmp** - 幅度谱 (对数尺度,便于观察)
3. **magnitude_spectrum_linear.bmp** - 幅度谱 (线性尺度)
4. **restored_image.bmp** - 通过逆傅里叶变换还原的图像

所有图像都是256x256像素的灰度图像,可以用任何图像查看器打开。

## 测试图像模式

程序支持三种测试图像生成模式,可在源代码中切换:

### 模式1: 圆形图案 (默认)
在图像中心生成一个实心圆,这是经典的频域分析测试图案
```c
// 默认启用,无需修改
```

### 模式2: 多频率正弦波叠加
生成包含多个不同频率成分的复合正弦波图案
```c
// 取消对应代码段的注释即可使用
```

### 模式3: 方形图案
在图像中心生成一个实心方形
```c
// 取消对应代码段的注释即可使用
```

## 修改图像尺寸

在main函数开头修改:
```c
int M = 256;  // 行数
int N = 256;  // 列数
```

**注意**: 图像尺寸越大,计算时间越长(DFT的复杂度为O(N²))。

## 图像还原演示

### 完整的变换流程

```
原始图像 (空域)
    ↓ 2D DFT
频域表示 (实部 + 虚部)
    ↓ 计算幅度谱
幅度谱可视化 (BMP图像)
    ↓ 使用完整的频域数据
2D IDFT (逆变换)
    ↓
还原图像 (空域)
```

### 验证可逆性

程序会自动执行以下步骤:

1. **正向变换**: `原始图像 → 频域数据(实部+虚部)`
2. **逆向变换**: `频域数据(实部+虚部) → 还原图像`
3. **误差计算**: `误差 = |原始图像 - 还原图像|`

### 理解误差来源

- **理论上**: DFT是完全可逆的,应该无损还原
- **实际上**: 由于计算机的浮点运算精度限制,会产生极小的舍入误差
- **误差量级**: 通常在10^-14到10^-15之间
- **可接受性**: 这个误差远小于任何实际应用的精度要求

### 实用价值

逆傅里叶变换在实际应用中非常重要:
- 🎯 **频域滤波**: 在频域修改后,通过IDFT还原到空域
- 📦 **图像压缩**: 保留重要频率分量,舍弃次要成分
- 🧹 **去噪处理**: 去除高频噪声后重建图像
- ✨ **图像增强**: 增强特定频率范围后还原
- 🔬 **科学分析**: 验证变换的正确性和数值稳定性

## 技术细节

### 2D DFT算法
采用行列分离方法:
1. 对每一行进行1D DFT
2. 对结果的每一列进行1D DFT

### 2D IDFT算法 (逆变换)
采用行列分离方法:
1. 对每一行进行1D IDFT
2. 对结果的每一列进行1D IDFT
3. 自动归一化,确保完美重建

### FFTShift (频谱中心化)
将频谱的四个象限重新排列,使零频率分量位于图像中心,便于观察和分析。

### 图像还原精度
程序会自动计算并显示还原误差:
- **最大误差**: 通常在10^-14量级
- **平均误差**: 通常在10^-15量级
- **还原精度**: 接近100.00%

这些极小的误差完全在浮点运算的舍入误差范围内,证明了DFT的完美可逆性。

### BMP文件格式
- 格式: 24位真彩色BMP (实际为灰度图)
- 字节序: BGR格式
- 存储顺序: 从下到上(BMP标准)
- 行对齐: 每行字节数为4的倍数

### 对数尺度显示
幅度谱使用 `log(1 + magnitude)` 进行压缩,使低幅度分量也能清晰可见。

## 应用场景

- 📷 **图像处理**: 频域滤波、图像增强、去噪
- 🔍 **模式识别**: 纹理分析、特征提取
- 🖼️ **图像分析**: 频率成分分析、噪声检测
- 📊 **信号处理**: 2D信号频谱分析
- 🔬 **科学研究**: 光学、声学、地震学等领域的信号分析
- 🎓 **教学演示**: 展示傅里叶变换的可逆性和频域特性

## 示例输出

```
2D FFT 示例 - 图像尺寸: 256 x 256

生成测试图像 (多个2D频率成分的叠加)...

频率成分:
  1. fx=2.0, fy=1.0, 振幅=1.00
  2. fx=4.0, fy=3.0, 振幅=0.50
  3. fx=1.0, fy=5.0, 振幅=0.30

正在执行 2D DFT...

保存图像文件...
已保存图像: original_image.bmp (尺寸: 256x256, 范围: [0.000, 1.000])
已保存图像: magnitude_spectrum.bmp (尺寸: 256x256, 范围: [0.002, 8.073])
已保存图像: magnitude_spectrum_linear.bmp (尺寸: 256x256, 范围: [0.002, 3205.000])

正在执行 2D IDFT (逆变换)...
已保存图像: restored_image.bmp (尺寸: 256x256, 范围: [-0.000, 1.000])
还原完成！
  最大误差: 5.007106e-14
  平均误差: 4.201679e-15
  还原精度: 100.00%
```

## 注意事项

⚠️ **性能提示**: 
- 当前实现为DFT (O(N⁴)),适合小尺寸图像
- 对于大尺寸图像,建议使用FFT算法 (O(N²logN))
- 256x256图像计算时间约几秒钟
- IDFT的计算时间与DFT相同

💡 **使用建议**:
- 圆形图案可展示Bessel函数的频谱特性
- 方形图案可展示sinc函数的频谱特性
- 对比 original_image.bmp 和 restored_image.bmp 验证重建精度
- 使用对数尺度的幅度谱可更好地观察低频和高频成分

🔬 **数值精度**:
- 还原误差主要来自浮点运算的舍入误差
- 双精度浮点数的机器精度约为2.22e-16
- 实测误差在10^-14到10^-15之间,接近理论极限

## 相关文件

- `main-fft2d.c` - 2D FFT源代码
- `fft2d` - 可执行文件
- `*.bmp` - 生成的图像文件

## 作者

GEHC FFT Project

## 许可

MIT License
