# 包络检波器演示

## 运行示例

本文档展示包络检波器的实际运行效果和输出。

## 1. 编译和运行

```bash
$ gcc -o envelope_detector envelope_detector.c -lm -O2
$ ./envelope_detector
```

## 2. 程序输出

```
========================================
  包络检波电路模拟器
  二极管 + RC 低通滤波器
========================================

信号参数:
  载波频率 fc = 10000 Hz
  调制频率 fm = 500 Hz
  采样频率 fs = 100000 Hz
  调制指数 μ = 0.80
  采样点数 n = 1000

生成 AM 信号...
✓ AM 信号生成完成

=== RC 参数计算 ===
载波频率 fc = 10000.00 Hz
调制频率 fm = 500.00 Hz
目标截止频率 = 500.00 Hz

推荐参数:
  R = 47000 Ω (47 kΩ)
  C = 1.00e-07 F (0.10 μF)
  实际截止频率 = 33.86 Hz
  τ = RC = 4.70e-03 s (4.70 ms)
==================

--- 方法 1: 基本包络检波器 ---

=== 包络检波器电路模拟 ===
✓ 二极管整流完成（Vd = 0.70 V）
RC滤波器参数:
  R = 47000 Ω
  C = 1.00e-07 F (0.10 μF)
  时间常数 τ = RC = 4.70e-03 s (4.70 ms)
  截止频率 fc = 1/(2πRC) = 33.86 Hz
  滤波系数 α = 0.002123
✓ RC 低通滤波完成
✓ 直流分量去除完成（DC = 0.5112 V）
=========================

--- 方法 2: 改进包络检波器 ---

=== 包络检波器电路模拟（改进版）===
✓ 二极管整流完成（Vd = 0.70 V）
✓ RC 低通滤波完成（梯形积分法）
✓ 直流分量去除完成（DC = 0.5113 V）
===================================

数据已保存到 envelope_detector_result.csv

=== 性能分析 ===
均方根误差 RMSE = 0.817584
==================

=== 测试不同 RC 参数的影响 ===

测试 1: R = 1kΩ, C = 0.1μF (τ = 0.1ms, fc ≈ 1.6kHz)
=== 包络检波器电路模拟 ===
✓ 二极管整流完成（Vd = 0.70 V）
RC滤波器参数:
  R = 1000 Ω
  C = 1.00e-07 F (0.10 μF)
  时间常数 τ = RC = 1.00e-04 s (0.10 ms)
  截止频率 fc = 1/(2πRC) = 1591.55 Hz
  滤波系数 α = 0.090909
✓ RC 低通滤波完成
✓ 直流分量去除完成（DC = 0.1040 V）
=========================

测试 2: R = 1MΩ, C = 1μF (τ = 1s, fc ≈ 0.16Hz)
=== 包络检波器电路模拟 ===
✓ 二极管整流完成（Vd = 0.70 V）
RC滤波器参数:
  R = 1000000 Ω
  C = 1.00e-06 F (1.00 μF)
  时间常数 τ = RC = 1.00e+00 s (1000.00 ms)
  截止频率 fc = 1/(2πRC) = 0.16 Hz
  滤波系数 α = 0.000010
✓ RC 低通滤波完成
✓ 直流分量去除完成（DC = 1.0950 V）
=========================

测试 3: 最佳参数
=== 包络检波器电路模拟 ===
✓ 二极管整流完成（Vd = 0.70 V）
RC滤波器参数:
  R = 47000 Ω
  C = 1.00e-07 F (0.10 μF)
  时间常数 τ = RC = 4.70e-03 s (4.70 ms)
  截止频率 fc = 1/(2πRC) = 33.86 Hz
  滤波系数 α = 0.002123
✓ RC 低通滤波完成
✓ 直流分量去除完成（DC = 0.5112 V）
=========================

包络检波器模拟完成！
========================================
```

## 3. 输出数据文件

### envelope_detector_result.csv

```csv
time,AM_Signal,Demodulated
0.00000000,1.80000000,0.58880814
0.00001000,1.45591123,0.58807759
0.00002000,0.55574277,0.58574368
0.00003000,-0.55513345,0.58341473
0.00004000,-1.45519181,0.58109076
...
```

**说明**:
- `time`: 时间 (秒)
- `AM_Signal`: AM 调制信号 (V)
- `Demodulated`: 解调后的信号 (V)

## 4. 可视化结果

### 4.1 包络检波结果图

运行可视化脚本：
```bash
$ python3 plot_envelope_detector.py
```

生成 `envelope_detector_result.png`，包含三个子图：

1. **AM 调制信号** - 显示完整的调幅波形
2. **包络检波过程** - AM 信号和提取的包络叠加
3. **解调信号对比** - 解调信号与理论调制信号对比

### 4.2 RC 滤波器频率响应

运行：
```bash
$ python3 plot_envelope_detector.py --rc
```

生成 `rc_filter_response.png`，显示：
- 幅度响应（对数坐标）
- 相位响应（对数坐标）
- 不同 RC 参数的对比

### 4.3 二极管特性曲线

运行：
```bash
$ python3 plot_envelope_detector.py --diode
```

生成 `diode_characteristic.png`，显示：
- I-V 特性曲线（指数模型）
- 整流器特性（分段线性模型）

## 5. 性能分析

### 数据统计

```python
AM 信号统计:
  最大值: 1.8000 V
  最小值: -1.7902 V
  均值: -0.0000 V
  标准差: 0.8124 V

解调信号统计:
  最大值: 0.5888 V
  最小值: -0.2985 V
  均值: -0.0000 V
  标准差: 0.2477 V
```

### 关键指标

| 指标 | 值 | 说明 |
|-----|---|------|
| 均方根误差 | 0.818 | 解调信号与理论信号的差异 |
| 截止频率 | 33.86 Hz | RC 滤波器的 -3dB 频率 |
| 时间常数 | 4.70 ms | RC 充放电时间常数 |
| 滤波系数 | 0.00212 | 数值计算的平滑系数 |

## 6. 参数影响分析

### 测试 1: R 太小 (1kΩ)
- **截止频率**: 1.6 kHz（太高）
- **问题**: 滤波不足，载波频率残留
- **直流偏移**: 0.104 V（很小）
- **适用场景**: 高频调制信号

### 测试 2: R 太大 (1MΩ)
- **截止频率**: 0.16 Hz（太低）
- **问题**: 响应过慢，无法跟随调制信号
- **直流偏移**: 1.095 V（很大）
- **适用场景**: 极低频调制信号

### 测试 3: 最佳参数 (47kΩ)
- **截止频率**: 33.86 Hz（适中）
- **优点**: 良好的载波抑制和信号保真度
- **直流偏移**: 0.511 V（适中）
- **适用场景**: ✅ 当前应用

## 7. 工作原理图解

### 信号变换过程

```
1. AM 信号输入
   ┌─────────────────────────────────────┐
   │ s(t) = [1 + 0.8·cos(2π·500t)]·cos(2π·10000t)
   │ 幅度: ±1.8 V
   │ 包含: 载波 + 上边带 + 下边带
   └─────────────────────────────────────┘
                    ↓
   
2. 二极管整流
   ┌─────────────────────────────────────┐
   │ V_out = max(0, V_in - 0.7)
   │ 去除负半周
   │ 保留正半周包络
   └─────────────────────────────────────┘
                    ↓
   
3. RC 低通滤波
   ┌─────────────────────────────────────┐
   │ fc = 33.86 Hz
   │ 滤除 10 kHz 载波
   │ 保留 500 Hz 调制信号
   └─────────────────────────────────────┘
                    ↓
   
4. 去除直流
   ┌─────────────────────────────────────┐
   │ m(t) ≈ cos(2π·500t)
   │ 恢复原始调制信号
   │ 均值: 0 V
   └─────────────────────────────────────┘
```

### 频域分析

```
输入 AM 信号频谱:
     |           |           |
     |           |           |
  ---|-----------|-----------|---
  9.5kHz     10kHz      10.5kHz
  (LSB)    (Carrier)    (USB)

     ↓ 包络检波 ↓

输出解调信号频谱:
          |
          |
  --------|--------
        500Hz
    (调制信号)
```

## 8. 实验建议

### 实验 1: 改变调制指数

修改代码中的 `mod_index`:
- 0.3: 浅调制
- 0.8: 标准调制
- 1.0: 100% 调制
- 1.2: 过调制（观察失真）

### 实验 2: 改变频率比

测试不同的载波/调制频率比:
- fc/fm = 10: 较小（可能失真）
- fc/fm = 20: 标准
- fc/fm = 100: 很大（良好分离）

### 实验 3: 添加噪声

在信号中添加噪声观察抗干扰性。

## 9. 常见问题解答

### Q: 为什么 RMSE 不是 0？

**A**: 真实电路存在固有误差：
1. 二极管压降损失
2. RC 滤波器不是理想低通
3. 数值计算截断误差
4. 包络检波本质上是非线性过程

### Q: 如何提高解调质量？

**A**: 可以尝试：
1. 优化 RC 参数（已自动完成）
2. 使用高阶滤波器
3. 减小调制指数
4. 提高采样频率
5. 使用相干解调代替包络检波

### Q: 程序可以处理实际音频吗？

**A**: 当前版本是演示程序，处理理想信号。要处理实际音频需要：
1. 添加音频文件读取
2. 实现实时处理
3. 考虑带宽限制
4. 添加自动增益控制

## 10. 总结

本包络检波器模拟器成功展示了：

✅ **真实电路行为** - 二极管特性、RC 充放电
✅ **自动参数优化** - 智能选择最佳 RC 值
✅ **完整的工作流** - 从信号生成到结果分析
✅ **教学价值** - 清晰的输出和可视化

适合用于：
- 📚 通信原理教学
- 🔬 电路设计研究
- 🎓 信号处理学习
- 🛠️ 算法验证测试

---

**演示完成！** 🎉
